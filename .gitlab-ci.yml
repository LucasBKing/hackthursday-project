image: node:10.14.0

cache:
  paths:
    - node_modules/


deploy-development:
  before_script:
    - mkdir -p ~/.aws
    - echo "[default]" >> ~/.aws/credentials
    - echo "aws_access_key_id =" $AWS_ACCESS >> ~/.aws/credentials
    - echo "aws_secret_access_key =" $AWS_SECRET >> ~/.aws/credentials
    - echo "[default]" >> ~/.aws/config
    - echo "region = sa-east" >> ~/.aws/config
    - echo "GATSBY_TOKEN_PUBLIC="$GATSBY_TOKEN_PUBLIC >> .env
    - echo "BUCKET_DEV="$BUCKET_DEV >> .env
  stage: deploy
  script:
    - yarn install
    - yarn build && yarn deploy -y
  only:
    - dev
